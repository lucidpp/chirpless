<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#ffffff">
    <title>X Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        :root {
            --x-blue: #1d9bf0;
            --x-black: #0f1419;
            --x-gray: #536471;
            --x-light-gray: #eff3f4;
            --anim-duration: 300ms;
            --anim-curve: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            color: var(--x-black);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }

        /* --- BULLETPROOF ODOMETER --- */
        .odometer {
            display: inline-flex;
            flex-direction: row;
            align-items: baseline;
            height: 1.25em;
            line-height: 1.25em;
            overflow: hidden;
            vertical-align: bottom;
            font-variant-numeric: tabular-nums;
            position: relative;
            white-space: nowrap;
        }

        .odometer-digit-container {
            display: inline-block;
            height: 100%;
            width: 0.65em; /* Fixed width prevents jitter */
            position: relative;
            overflow: hidden;
        }

        .odometer-suffix, .odometer-comma {
            display: inline-block;
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .odometer-suffix { vertical-align: super; font-size: 0.7em; }

        .digit-track {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            will-change: transform;
            /* 11 items: 0 1 2 3 4 5 6 7 8 9 0 */
            height: 1100%; 
            transition: transform var(--anim-duration) var(--anim-curve);
        }

        .digit-value {
            height: 9.09%; /* 100 / 11 */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Reset class for wrapping 9->0 */
        .track-reset { transition: none !important; }

        /* --- LIKE ANIMATION --- */
        .like-btn-inner {
            transition: transform 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        
        .action-group:active .like-btn-inner { transform: scale(0.8); }

        .liked .icon-like {
            fill: #f91880; /* Pink/Red for likes usually, but user asked Blue previously. Sticking to standard X Pink for "Heart", Blue for "Verify" */
            stroke: #f91880;
            animation: heart-pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* User previously requested Blue Likes specifically. Overriding to Blue. */
        .liked-blue .icon-like {
            fill: var(--x-blue);
            stroke: var(--x-blue);
            animation: heart-pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes heart-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* --- UI ELEMENTS --- */
        .action-icon-wrapper { padding: 8px; border-radius: 9999px; transition: background 0.2s; margin: -8px; }
        .action-group:hover .action-icon-wrapper { background: rgba(29, 155, 240, 0.1); }
        .action-group:hover .action-count { color: var(--x-blue); }
        
        .trending-badge { font-size: 11px; font-weight: 700; color: #536471; display: flex; align-items: center; gap: 4px; margin-bottom: 4px; }
        .trending-rank { color: #1d9bf0; }

        .tab-active { font-weight: 700; color: black; border-bottom: 4px solid #1d9bf0; }
        
        /* Video Player */
        .custom-player { position: relative; background: black; width: 100%; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; }
        .custom-player video { width: 100%; height: 100%; object-fit: contain; }
        .player-controls { position: absolute; bottom: 0; left: 0; right: 0; padding: 12px; background: linear-gradient(transparent, rgba(0,0,0,0.7)); opacity: 0; transition: opacity 0.2s; display: flex; align-items: center; justify-content: space-between; }
        .custom-player:hover .player-controls, .custom-player.paused .player-controls { opacity: 1; }
        .play-overlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; pointer-events: none; }
        .play-icon { width: 50px; height: 50px; background: rgba(29,155,240,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; opacity: 0; transition: transform 0.2s; }
        .custom-player.paused .play-icon { opacity: 1; }
    </style>
</head>
<body class="flex justify-center min-h-screen">

    <!-- DESKTOP SIDEBAR -->
    <header class="hidden md:flex flex-col items-end w-[275px] pr-6 h-screen sticky top-0">
        <div class="w-[250px] flex flex-col h-full pb-4 pt-2">
            <div class="w-12 h-12 flex items-center justify-center hover:bg-gray-100 rounded-full cursor-pointer transition-colors mb-2" onclick="navTo('home')">
                <!-- No Logo, just blank clickable area per request -->
                <div class="w-6 h-6 bg-black rounded-full"></div> 
            </div>
            
            <nav class="space-y-2 w-full text-xl">
                <a onclick="navTo('home')" class="flex items-center gap-4 p-3 rounded-full hover:bg-gray-100 cursor-pointer">
                    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    <span class="font-bold">Home</span>
                </a>
                <a class="flex items-center gap-4 p-3 rounded-full hover:bg-gray-100 cursor-pointer">
                    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <span>Explore</span>
                </a>
                <a onclick="navTo('collab')" class="flex items-center gap-4 p-3 rounded-full hover:bg-gray-100 cursor-pointer">
                    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    <span>Collab</span>
                </a>
                <a onclick="navTo('profile')" class="flex items-center gap-4 p-3 rounded-full hover:bg-gray-100 cursor-pointer">
                    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                    <span>Profile</span>
                </a>
            </nav>

            <button onclick="openCompose()" class="mt-4 bg-[#1d9bf0] text-white font-bold py-3.5 rounded-full w-[90%] shadow-md hover:bg-[#1a8cd8] transition-colors">Post</button>

            <div class="mt-auto flex items-center gap-3 p-3 hover:bg-gray-100 rounded-full cursor-pointer" onclick="navTo('profile')">
                <img id="sidebar-avatar" class="w-10 h-10 rounded-full bg-gray-200 object-cover">
                <div class="hidden xl:block">
                    <div class="font-bold text-sm" id="sidebar-name">User</div>
                    <div class="text-gray-500 text-sm" id="sidebar-handle">@handle</div>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN FEED AREA -->
    <main id="app" class="w-full max-w-[600px] min-h-screen border-x border-gray-100 pb-16 md:pb-0 relative">
        
        <!-- HEADER MOBILE -->
        <div class="sticky top-0 z-50 bg-white/85 backdrop-blur-md border-b border-gray-100 md:hidden flex justify-between items-center px-4 h-14">
            <img id="mobile-header-avatar" class="w-8 h-8 rounded-full bg-gray-200" onclick="navTo('profile')">
            <div class="w-6 h-6 bg-black rounded-full"></div> <!-- Logo placeholder -->
            <div class="w-8"></div>
        </div>

        <!-- VIEWS -->
        <div id="view-home" class="view-section">
            <div class="flex border-b border-gray-100">
                <div class="flex-1 h-12 flex items-center justify-center hover:bg-gray-50 cursor-pointer tab-active">For you</div>
                <div class="flex-1 h-12 flex items-center justify-center hover:bg-gray-50 cursor-pointer text-gray-500">Following</div>
            </div>
            <!-- Desktop Compose -->
            <div class="hidden md:flex gap-3 p-4 border-b border-gray-100">
                <img id="desktop-compose-avatar" class="w-10 h-10 rounded-full bg-gray-200">
                <div class="flex-1">
                    <textarea id="desktop-input" placeholder="What is happening?!" class="w-full text-xl outline-none resize-none h-12 focus:h-24 transition-all placeholder-gray-500"></textarea>
                    <div id="desktop-media-preview" class="hidden mt-2 rounded-xl overflow-hidden relative"></div>
                    <div class="flex justify-between items-center mt-2 pt-2 border-t border-gray-100">
                        <div class="flex gap-2 text-[#1d9bf0]">
                            <label class="p-2 hover:bg-blue-50 rounded-full cursor-pointer"><input type="file" accept="image/*" hidden onchange="handleMedia('desktop', 'image')"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg></label>
                            <label class="p-2 hover:bg-blue-50 rounded-full cursor-pointer"><input type="file" accept="video/*" hidden onchange="handleMedia('desktop', 'video')"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 7l-7 5 7 5V7z"></path><rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect></svg></label>
                        </div>
                        <button id="desktop-post-btn" onclick="submitPost('desktop')" class="bg-[#1d9bf0] text-white font-bold px-4 py-1.5 rounded-full disabled:opacity-50" disabled>Post</button>
                    </div>
                </div>
            </div>
            <div id="feed-list"></div>
        </div>

        <div id="view-profile" class="view-section hidden">
            <div class="h-32 bg-gray-200"></div>
            <div class="px-4 relative">
                <div class="w-32 h-32 rounded-full border-4 border-white bg-white absolute -top-16 overflow-hidden">
                    <img id="profile-lg-avatar" class="w-full h-full object-cover">
                </div>
                <div class="flex justify-end gap-2 py-3">
                    <button onclick="resetData()" class="px-4 py-1.5 border border-red-200 text-red-600 rounded-full font-bold text-sm hover:bg-red-50">Reset Data</button>
                    <button onclick="editProfile()" class="px-4 py-1.5 border border-gray-300 rounded-full font-bold text-sm hover:bg-gray-100">Edit profile</button>
                </div>
                <div class="mt-2">
                    <h1 class="font-black text-xl flex items-center gap-1"><span id="profile-name">Name</span><span id="profile-verify"></span></h1>
                    <div class="text-gray-500 text-sm">@<span id="profile-handle">handle</span></div>
                    <div class="flex gap-4 mt-3 text-sm">
                        <span class="hover:underline cursor-pointer"><span class="font-bold text-black" id="profile-following">0</span> <span class="text-gray-500">Following</span></span>
                        <span class="hover:underline cursor-pointer" onclick="editFollowers()"><span class="font-bold text-black" id="profile-followers">0</span> <span class="text-gray-500">Followers</span></span>
                    </div>
                </div>
            </div>
            <div id="profile-list" class="mt-4 border-t border-gray-100"></div>
        </div>

        <div id="view-collab" class="view-section hidden p-4">
            <h1 class="font-bold text-xl mb-4">Bot Collabs</h1>
            <button onclick="createBot()" class="w-full py-3 bg-black text-white rounded-full font-bold mb-4">Create New Bot</button>
            <div id="bot-list" class="space-y-2"></div>
        </div>

        <!-- POST DETAIL -->
        <div id="view-post-detail" class="view-section hidden">
            <div class="flex items-center gap-6 px-4 h-14 border-b border-gray-100 sticky top-0 bg-white/85 backdrop-blur z-50">
                <button onclick="navTo('home')">‚Üê</button>
                <span class="font-bold text-lg">Post</span>
            </div>
            <div id="post-detail-content"></div>
        </div>

    </main>

    <!-- RIGHT SIDEBAR (TRENDING) -->
    <div class="hidden lg:block w-[350px] pl-8 pt-4 h-screen sticky top-0">
        <div class="bg-gray-100 rounded-full h-10 flex items-center px-4 mb-4 text-gray-500">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
            <span class="ml-3">Search</span>
        </div>
        <div class="bg-gray-50 rounded-2xl py-3">
            <h2 class="font-black text-xl px-4 mb-3">Trending for you</h2>
            <div id="trending-wall"></div>
        </div>
    </div>

    <!-- MOBILE NAV -->
    <nav class="fixed bottom-0 w-full h-[53px] bg-white border-t border-gray-100 flex justify-around items-center md:hidden z-50">
        <button onclick="navTo('home')"><svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></button>
        <button onclick="navTo('collab')"><svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle></svg></button>
        <button onclick="navTo('profile')"><svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></button>
    </nav>

    <!-- FAB -->
    <button onclick="openCompose()" class="fixed bottom-20 right-4 w-14 h-14 bg-[#1d9bf0] rounded-full text-white shadow-lg flex items-center justify-center md:hidden z-50">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"></path></svg>
    </button>

    <!-- COMPOSE MODAL -->
    <div id="compose-modal" class="fixed inset-0 bg-black/40 z-[60] hidden flex items-start justify-center pt-12">
        <div class="bg-white w-full h-full md:h-auto md:w-[600px] md:rounded-2xl p-4 flex flex-col">
            <div class="flex justify-between mb-4">
                <button onclick="closeCompose()">Cancel</button>
                <button id="mobile-post-btn" onclick="submitPost('mobile')" class="bg-[#1d9bf0] text-white font-bold px-4 py-1.5 rounded-full disabled:opacity-50" disabled>Post</button>
            </div>
            <textarea id="mobile-input" placeholder="What is happening?!" class="w-full text-xl outline-none resize-none h-32"></textarea>
            <div id="mobile-media-preview" class="hidden mt-2 rounded-xl overflow-hidden relative max-h-60"></div>
            <div class="mt-4 pt-3 border-t border-gray-100 flex gap-4 text-[#1d9bf0]">
                <label><input type="file" accept="image/*" hidden onchange="handleMedia('mobile', 'image')">üì∑</label>
                <label><input type="file" accept="video/*" hidden onchange="handleMedia('mobile', 'video')">üé•</label>
            </div>
        </div>
    </div>

    <script>
        // --- CONSTANTS ---
        const VERIFIED = `<svg class="w-4 h-4 text-[#1d9bf0] inline-block ml-1 align-text-bottom" viewBox="0 0 24 24" fill="currentColor"><path d="M22.5 12.5c0-1.58-.875-2.95-2.148-3.6.154-.435.238-.905.238-1.4 0-2.21-1.71-3.998-3.818-3.998-.47 0-.92.175-1.297.503C14.78 2.67 13.438 2 12 2s-2.78.67-3.475 2.005c-.377-.328-.827-.503-1.297-.503-2.108 0-3.818 1.788-3.818 3.998 0 .495.084.965.238 1.4-1.273.65-2.148 2.02-2.148 3.6 0 1.58.875 2.95 2.148 3.6-.154.435-.238.905-.238 1.4 0 2.21 1.71 3.998 3.818 3.998.47 0 .92-.175 1.297-.503.695 1.335 2.037 2.005 3.475 2.005s2.78-.67 3.475-2.005c.377.328.827.503 1.297.503 2.108 0 3.818-1.788 3.818-3.998 0-.495-.084-.965-.238-1.4 1.273-.65 2.148-2.02 2.148-3.6zM9.763 16.296l-4.24-4.24 1.414-1.414 2.826 2.826 6.364-6.364 1.414 1.414-7.778 7.778z"></path></svg>`;
        
        let appData = {
            user: { name: "User", handle: "user", followers: 100, following: 20, avatar: `https://ui-avatars.com/api/?name=User&background=random` },
            posts: [],
            bots: [],
            lastActive: Date.now()
        };
        let currentMedia = { desktop: null, mobile: null };

        // --- INIT ---
        function init() {
            const saved = localStorage.getItem('x_sim_v3');
            if (saved) {
                appData = JSON.parse(saved);
                simulateTimeAway();
            } else {
                // Default starter post
                createPost("Welcome to X Simulator! üöÄ", null, true);
            }
            
            // Render initial state
            renderAll();
            
            // Loop
            setInterval(() => {
                simulateLive();
                renderFeeds(); // Re-render feeds to update odometers
                renderTrending();
            }, 1000);

            // Inputs
            ['desktop', 'mobile'].forEach(mode => {
                document.getElementById(`${mode}-input`).addEventListener('input', (e) => {
                    document.getElementById(`${mode}-post-btn`).disabled = e.target.value.trim() === '';
                });
            });

            // Save on exit
            window.addEventListener('beforeunload', () => {
                appData.lastActive = Date.now();
                localStorage.setItem('x_sim_v3', JSON.stringify(appData));
            });
        }

        // --- DOM RENDERERS ---
        function renderAll() {
            renderProfileData();
            renderFeeds();
            renderBots();
            renderTrending();
        }

        function renderProfileData() {
            const els = ['sidebar-avatar', 'mobile-header-avatar', 'desktop-compose-avatar', 'profile-lg-avatar'];
            els.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.src = appData.user.avatar;
            });

            document.getElementById('sidebar-name').innerText = appData.user.name;
            document.getElementById('sidebar-handle').innerText = '@' + appData.user.handle;
            
            document.getElementById('profile-name').innerText = appData.user.name;
            document.getElementById('profile-handle').innerText = appData.user.handle;
            
            if(appData.user.followers >= 100000) {
                document.getElementById('profile-verify').innerHTML = VERIFIED;
            }

            document.getElementById('profile-followers').innerText = formatNumber(appData.user.followers);
            document.getElementById('profile-following').innerText = formatNumber(appData.user.following);
        }

        function renderFeeds() {
            const feedContainer = document.getElementById('feed-list');
            const profileContainer = document.getElementById('profile-list');
            
            // Clear current (inefficient but safe for keeping sync)
            feedContainer.innerHTML = '';
            profileContainer.innerHTML = '';

            const sorted = [...appData.posts].sort((a,b) => b.timestamp - a.timestamp);

            sorted.forEach(post => {
                feedContainer.appendChild(createPostElement(post));
                profileContainer.appendChild(createPostElement(post));
            });
        }

        function createPostElement(post) {
            const div = document.createElement('div');
            div.className = "p-4 border-b border-gray-100 hover:bg-gray-50 cursor-pointer transition-colors";
            div.onclick = () => openPostDetail(post.id);

            const verifyBadge = appData.user.followers >= 100000 ? VERIFIED : '';
            const trendingRank = getTrendingRank(post.id);
            const trendingHtml = trendingRank ? `<div class="trending-badge"><span class="trending-rank">#${trendingRank} on Trending</span></div>` : '';

            let mediaHtml = '';
            if(post.media) {
                if(post.media.type === 'image') mediaHtml = `<div class="mt-3 rounded-xl overflow-hidden border border-gray-200"><img src="${post.media.data}" class="w-full object-cover max-h-[500px]"></div>`;
                else mediaHtml = `<div class="mt-3 rounded-xl overflow-hidden border border-gray-200 aspect-video custom-player paused" onclick="event.stopPropagation(); toggleVideo(this)"><video src="${post.media.data}" loop playsinline></video><div class="play-overlay"><div class="play-icon">‚ñ∂</div></div></div>`;
            }

            // Odometer HTML generators
            const odo = (val) => `<span class="odometer" data-value="${val}">${generateOdometerHtml(val)}</span>`;

            div.innerHTML = `
                <div class="flex gap-3">
                    <img src="${appData.user.avatar}" class="w-10 h-10 rounded-full bg-gray-200 shrink-0">
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-1 text-[15px]">
                            <span class="font-bold truncate">${appData.user.name}</span>${verifyBadge}
                            <span class="text-gray-500 truncate">@${appData.user.handle}</span>
                            <span class="text-gray-500 text-xs">¬∑ ${timeAgo(post.timestamp)}</span>
                        </div>
                        ${trendingHtml}
                        <div class="text-[15px] whitespace-pre-wrap leading-6">${post.content}</div>
                        ${mediaHtml}
                        <div class="flex justify-between mt-3 max-w-md text-gray-500 text-xs">
                            <div class="action-group flex items-center gap-1 group hover:text-blue-500">
                                <div class="action-icon-wrapper"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg></div>
                                ${odo(post.stats.replies)}
                            </div>
                            <div class="action-group flex items-center gap-1 group hover:text-green-500 ${post.interacted.repost ? 'reposted' : ''}" onclick="event.stopPropagation(); interact('${post.id}', 'repost')">
                                <div class="action-icon-wrapper"><svg class="icon-repost" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path></svg></div>
                                <span class="action-count">${odo(post.stats.reposts)}</span>
                            </div>
                            <div class="action-group flex items-center gap-1 group hover:text-blue-500 ${post.interacted.like ? 'liked-blue' : ''}" onclick="event.stopPropagation(); interact('${post.id}', 'like')">
                                <div class="action-icon-wrapper like-btn-inner"><svg class="icon-like" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></div>
                                <span class="action-count">${odo(post.stats.likes)}</span>
                            </div>
                            <div class="action-group flex items-center gap-1 group hover:text-blue-500">
                                <div class="action-icon-wrapper"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg></div>
                                ${odo(post.stats.views)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            return div;
        }

        // --- ODOMETER LOGIC (Bulletproof) ---
        function formatNumber(num) {
            if (num < 1000) return num.toString();
            if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            return (num / 1000).toFixed(1) + 'K';
        }

        function generateOdometerHtml(value) {
            const str = formatNumber(value);
            return str.split('').map(char => {
                if(isNaN(parseInt(char))) return `<span class="odometer-suffix">${char}</span>`;
                return `
                    <span class="odometer-digit-container">
                        <span class="digit-track" style="transform: translateY(-${parseInt(char) * 9.09}%)">
                            ${[0,1,2,3,4,5,6,7,8,9,0].map(d => `<span class="digit-value">${d}</span>`).join('')}
                        </span>
                    </span>
                `;
            }).join('');
        }

        // --- SIMULATION LOGIC ---
        function simulateTimeAway() {
            const now = Date.now();
            const elapsed = (now - appData.lastActive) / 1000;
            if(elapsed < 1) return;

            appData.posts.forEach(post => {
                // Calc decay integral
                const age = (now - post.timestamp) / 1000;
                // Simple physics: View Rate = (Followers * 0.1) * e^(-age / 6hours)
                // Integral of e^-kt is -1/k e^-kt
                // We just approximate bulk addition here for stability
                const decayFactor = Math.exp(-age / 21600); 
                const baseViews = Math.max(10, appData.user.followers * 0.5) * elapsed * decayFactor;
                
                if (baseViews > 1) {
                    const added = Math.floor(baseViews);
                    post.stats.views += added;
                    post.stats.likes += Math.floor(added * 0.05); // 5% likes
                    post.stats.reposts += Math.floor(added * 0.02);
                }
            });
            // Passive follower growth
            if (elapsed > 3600) appData.user.followers += Math.floor(elapsed / 3600);
        }

        function simulateLive() {
            appData.posts.forEach(post => {
                const age = (Date.now() - post.timestamp) / 1000;
                const decay = Math.exp(-age / 21600); // 6 hour half-life roughly
                
                // Base probability per tick
                let chance = (appData.user.followers / 1000) * decay;
                
                // Bot boost
                const botPower = appData.bots.reduce((a,b) => a + b.followers, 0);
                chance += (botPower / 5000) * decay;

                if(Math.random() < chance) {
                    const add = Math.ceil(Math.random() * 5); // burst
                    post.stats.views += add;
                    if(Math.random() < 0.1) post.stats.likes++;
                    if(Math.random() < 0.02) post.stats.reposts++;
                }
            });
        }

        // --- ACTIONS ---
        function createPost(txt, media, skipRender) {
            const newPost = {
                id: Date.now().toString(),
                content: txt,
                media: media,
                timestamp: Date.now(),
                stats: { views: 0, likes: 0, reposts: 0, replies: 0 },
                interacted: { like: false, repost: false }
            };
            appData.posts.unshift(newPost);
            if(!skipRender) renderFeeds();
        }

        function submitPost(mode) {
            const txt = document.getElementById(`${mode}-input`).value;
            const media = currentMedia[mode];
            if(!txt && !media) return;
            createPost(txt, media);
            // Reset UI
            document.getElementById(`${mode}-input`).value = '';
            document.getElementById(`${mode}-media-preview`).classList.add('hidden');
            currentMedia[mode] = null;
            if(mode === 'mobile') closeCompose();
        }

        function interact(id, type) {
            const post = appData.posts.find(p => p.id === id);
            if(!post) return;
            const active = !post.interacted[type];
            post.interacted[type] = active;
            post.stats[type + 's'] += active ? 1 : -1;
            renderFeeds(); // Re-render to update classes and numbers
        }

        function handleMedia(mode, type) {
            const file = event.target.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                currentMedia[mode] = { type, data: e.target.result };
                const el = document.getElementById(`${mode}-media-preview`);
                el.classList.remove('hidden');
                el.innerHTML = type === 'image' 
                    ? `<img src="${e.target.result}" class="w-full h-full object-cover">`
                    : `<video src="${e.target.result}" controls class="w-full h-full"></video>`;
                document.getElementById(`${mode}-post-btn`).disabled = false;
            };
            reader.readAsDataURL(file);
        }

        // --- VIDEO PLAYER ---
        function toggleVideo(container) {
            const v = container.querySelector('video');
            if(v.paused) { v.play(); container.classList.remove('paused'); }
            else { v.pause(); container.classList.add('paused'); }
        }

        // --- TRENDING ---
        function getTrendingRank(id) {
            // Sort by views, get index
            const sorted = [...appData.posts].sort((a,b) => b.stats.views - a.stats.views);
            const idx = sorted.findIndex(p => p.id === id);
            if(idx < 5 && sorted[idx].stats.views > 50) return idx + 1;
            return null;
        }

        function renderTrending() {
            const container = document.getElementById('trending-wall');
            const top5 = [...appData.posts].sort((a,b) => b.stats.views - a.stats.views).slice(0,5);
            container.innerHTML = top5.map((p, i) => `
                <div class="px-4 py-3 hover:bg-gray-100 cursor-pointer border-b border-gray-50" onclick="openPostDetail('${p.id}')">
                    <div class="text-xs text-gray-500">Trending in Tech</div>
                    <div class="font-bold text-sm line-clamp-1">${p.content}</div>
                    <div class="text-xs text-gray-500">${formatNumber(p.stats.views)} views</div>
                </div>
            `).join('');
        }

        // --- NAVIGATION ---
        function navTo(page) {
            ['home', 'profile', 'collab', 'post-detail'].forEach(v => document.getElementById(`view-${v}`).classList.add('hidden'));
            document.getElementById(`view-${page === 'trending' ? 'home' : page}`).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        function openPostDetail(id) {
            const post = appData.posts.find(p => p.id === id);
            if(!post) return;
            navTo('post-detail');
            // Simplified Detail View Render (reuses createPostElement logic visually)
            const container = document.getElementById('post-detail-content');
            container.innerHTML = '';
            container.appendChild(createPostElement(post)); 
        }

        function createBot() {
            const name = prompt("Bot Name");
            const followers = parseInt(prompt("Followers", "1000"));
            if(name) {
                appData.bots.push({ name, followers });
                renderBots();
            }
        }

        function renderBots() {
            document.getElementById('bot-list').innerHTML = appData.bots.map((b,i) => `
                <div class="flex justify-between p-3 bg-gray-50 rounded">
                    <div><b>${b.name}</b> <span class="text-xs text-gray-500">${formatNumber(b.followers)}</span></div>
                    <button class="text-red-500 text-xs" onclick="appData.bots.splice(${i},1); renderBots()">Delete</button>
                </div>
            `).join('');
        }

        function editProfile() {
            appData.user.name = prompt("Name", appData.user.name) || appData.user.name;
            renderAll();
        }
        function editFollowers() {
            const f = parseInt(prompt("Followers", appData.user.followers));
            if(!isNaN(f)) { appData.user.followers = f; renderAll(); }
        }
        function resetData() {
            if(confirm("Reset all?")) {
                localStorage.removeItem('x_sim_v3');
                location.reload();
            }
        }
        function openCompose() { document.getElementById('compose-modal').classList.remove('hidden'); }
        function closeCompose() { document.getElementById('compose-modal').classList.add('hidden'); }
        function timeAgo(ts) {
            const s = Math.floor((Date.now()-ts)/1000);
            if(s<60) return s+'s';
            if(s<3600) return Math.floor(s/60)+'m';
            return Math.floor(s/3600)+'h';
        }

        document.addEventListener('DOMContentLoaded', init);

    </script>
</body>
</html>
